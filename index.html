<script>
  let words = [];
  let currentIndex = 0;
  let timer = 60;
  let countdown;

  const definitionEl = document.getElementById("definition");
  const hintEl = document.getElementById("hint");
  const guessInput = document.getElementById("guessInput");
  const messageEl = document.getElementById("message");
  const nextBtn = document.getElementById("nextBtn");
  const dictSelect = document.getElementById("dictSelect");

  // ðŸ•’ Create timer element
  const timerEl = document.createElement("p");
  timerEl.style.fontSize = "22px";
  timerEl.style.fontWeight = "bold";
  timerEl.style.color = "#d6336c";
  timerEl.id = "timer";
  hintEl.insertAdjacentElement("afterend", timerEl);

  function loadDictionaryAndStart() {
    const dictFile = dictSelect.value;
    fetch(dictFile)
      .then(response => {
        if (!response.ok) throw new Error("Failed to load dictionary");
        return response.json();
      })
      .then(data => {
        words = Object.entries(data).map(([word, definition]) => ({ word, definition }));
        words.sort(() => Math.random() - 0.5);
        currentIndex = 0;
        showDefinition();
      })
      .catch(error => {
        definitionEl.textContent = "âš ï¸ Could not load dictionary file.";
        console.error(error);
      });
  }

  dictSelect.addEventListener('change', () => {
    clearInterval(countdown);
    loadDictionaryAndStart();
  });

  function showDefinition() {
    clearInterval(countdown);
    timer = 60;
    updateTimer();

    if (!words || words.length === 0) {
      definitionEl.textContent = "No words available in the selected dictionary.";
      hintEl.textContent = "";
      guessInput.style.display = 'none';
      nextBtn.style.display = 'none';
      return;
    }

    const currentWord = words[currentIndex];
    definitionEl.textContent = currentWord.definition;
    const firstLetter = currentWord.word.charAt(0).toUpperCase();
    hintEl.textContent = `Hint: starts with "${firstLetter}" and has ${currentWord.word.length} letters.`;
    guessInput.value = "";
    guessInput.disabled = false;
    messageEl.textContent = "";
    nextBtn.disabled = true;
    guessInput.style.display = '';
    nextBtn.style.display = '';
    guessInput.focus();

    // â±ï¸ start timer
    countdown = setInterval(() => {
      timer--;
      updateTimer();
      if (timer <= 0) {
        clearInterval(countdown);
        timeUp();
      }
    }, 1000);
  }

  function updateTimer() {
    timerEl.textContent = `â± ${timer}s`;
  }

  function checkGuess() {
    const userGuess = guessInput.value.trim().toLowerCase();
    if (userGuess === "") {
      messageEl.textContent = "Please enter a guess.";
      return;
    }

    if (userGuess === words[currentIndex].word.toLowerCase()) {
      clearInterval(countdown);
      messageEl.style.color = "#28a745";
      messageEl.textContent = "ðŸŽ‰ Correct!";
      guessInput.disabled = true;
      nextBtn.disabled = false;
    } else {
      messageEl.style.color = "#d6336c";
      messageEl.textContent = "âŒ Incorrect. Try again.";
    }
  }

  function timeUp() {
    messageEl.style.color = "#d6336c";
    messageEl.textContent = `â° Time's up! The correct word was "${words[currentIndex].word}".`;
    guessInput.disabled = true;
    nextBtn.disabled = false;
  }

  function nextWord() {
    clearInterval(countdown);
    currentIndex++;
    if (currentIndex >= words.length) {
      definitionEl.textContent = "ðŸŽŠ You've completed all words!";
      hintEl.textContent = "";
      timerEl.style.display = "none";
      guessInput.style.display = "none";
      nextBtn.style.display = "none";
      messageEl.textContent = "";
    } else {
      showDefinition();
    }
  }

  // initial load
  loadDictionaryAndStart();
</script>
